<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="google-site-verification" content="" />
  <meta name="referrer" content="unsafe-url">
  
  <title>My OS</title>
  <meta name="author" content="Abracat">
  <meta name="description" content="NH3OSFIRST PLACE in Microsoft Sponsored Kernel Design Competition.
HAPPY GRADUATION!
Baseline Functionality
PS/2 keyboard driver
i8259 driver
pit and ">
  
  
  <meta property="og:title" content="My OS"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:site_name" content="Abracax&#39;s Notes"/>
  <link href="/apple-touch-icon-precomposed.png" sizes="180x180" rel="apple-touch-icon-precomposed">
  <link rel="alternate" href="/blog/atom.xml" title="Abracax&#39;s Notes" type="application/atom+xml">
  <link rel="stylesheet" href="/blog/css/m.min.css">
  <link rel="icon" type="image/x-icon" href="/blog/favicon.ico">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>

</head>

<body>
  <a id="top"></a>
  <div id="main">
    <div class="main-ctnr">
      <div class="behind">
  <a href="/blog/" class="back black-color">
    <svg class="i-close" viewBox="0 0 32 32" width="22" height="22" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3">
        <path d="M2 30 L30 2 M30 30 L2 2"></path>
    </svg>
  </a>
  
</div>


  <article class="standard post">
    <div class="title">
      
  
    <h1 class="page-title center">
        My OS
    </h1>
  


    </div>
    <div class="meta center">
      <time datetime="2021-05-19T16:58:55.000Z" itemprop="datePublished">
  <svg class="i-calendar" viewBox="0 0 32 32" width="16" height="16" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
    <path d="M2 6 L2 30 30 30 30 6 Z M2 15 L30 15 M7 3 L7 9 M13 3 L13 9 M19 3 L19 9 M25 3 L25 9"></path>
  </svg>
  &nbsp;
  2021-05-20
</time>






    </div>
    <hr>
    
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#NH3OS"><span class="toc-text">NH3OS</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Baseline-Functionality"><span class="toc-text">Baseline Functionality</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Extra-Functionality"><span class="toc-text">Extra Functionality</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Extra-Device-Drivers"><span class="toc-text">Extra Device Drivers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GUI"><span class="toc-text">GUI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Networking-Stack"><span class="toc-text">Networking Stack</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Some-Networking-Explanation"><span class="toc-text">Some Networking Explanation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bug-List"><span class="toc-text">Bug List</span></a></li></ol></li></ol></li></ol>
    
    <div class="picture-container">
      
    </div>
    <h1 id="NH3OS"><a href="#NH3OS" class="headerlink" title="NH3OS"></a>NH3OS</h1><p><strong>FIRST PLACE</strong> in Microsoft Sponsored Kernel Design Competition.</p>
<p><strong>HAPPY GRADUATION!</strong></p>
<h2 id="Baseline-Functionality"><a href="#Baseline-Functionality" class="headerlink" title="Baseline Functionality"></a>Baseline Functionality</h2><ul>
<li>PS/2 keyboard driver</li>
<li>i8259 driver</li>
<li>pit and rtc driver</li>
<li>GDT/IDT</li>
<li>Basic Exception/Trap Handlers</li>
<li>Paging</li>
<li>VGA Text-mode terminal</li>
<li>Initrd Read-only Filesystem (fake)</li>
<li>System Calls (read, write, videomap…)</li>
<li>Process Control Block</li>
<li>User level code loader and user/kernel stack switching</li>
<li>Round-robin scheduling</li>
<li>Heap (fake)</li>
</ul>
<h2 id="Extra-Functionality"><a href="#Extra-Functionality" class="headerlink" title="Extra Functionality"></a>Extra Functionality</h2><h3 id="Extra-Device-Drivers"><a href="#Extra-Device-Drivers" class="headerlink" title="Extra Device Drivers"></a>Extra Device Drivers</h3><ul>
<li>PS/2 Mouse Driver</li>
<li>PCI Driver</li>
<li>RTL8139 Driver</li>
</ul>
<h3 id="GUI"><a href="#GUI" class="headerlink" title="GUI"></a>GUI</h3><ul>
<li>Cascading windows</li>
<li>VESA high resolution display</li>
<li>Windows drag and drop using mouse</li>
<li>Basic responsive support (open close)</li>
</ul>
<h3 id="Networking-Stack"><a href="#Networking-Stack" class="headerlink" title="Networking Stack"></a>Networking Stack</h3><ul>
<li>NIC: RTL8139 Driver, ring buffer</li>
<li>Link Layer: Ethernet II support</li>
<li>Network Layer: ARP</li>
<li>Network Layer:  IPv4</li>
<li>Transport Layer: UDP</li>
<li>Transport Layer: TCP (Buggy)</li>
<li>Application Layer: DNS</li>
</ul>
<h3 id="Some-Networking-Explanation"><a href="#Some-Networking-Explanation" class="headerlink" title="Some Networking Explanation"></a>Some Networking Explanation</h3><p><img src="/blog/2021/05/20/My-OS-my-choice/Slirp_concept.png"></p>
<ul>
<li><p>Qemu has a whole user mode network stack, it can redirect TCP and UDP protocols from qemu user to host.</p>
</li>
<li><p>Thus our OS’s NIC has IP address 10.0.2.15</p>
</li>
<li><p>We send ARP requests to get the mac address of gateway (10.0.2.2), this is placed in any IPv4 packet leaving our OS</p>
</li>
<li><p>DNS requests to 10.0.2.3:53, just send UDP requests and parse responses </p>
</li>
<li><p>Note that from inside the guest, connecting to a port on the “gateway” 10.0.2.2 will connect to that port on the host</p>
</li>
<li><p>To connect Host to Guest use TCP hostfwd when launching Qemu</p>
</li>
<li><p>Debugging:  use Wireshark and object dump to analyze packets</p>
</li>
</ul>
<h3 id="Bug-List"><a href="#Bug-List" class="headerlink" title="Bug List"></a>Bug List</h3><ul>
<li><input disabled="" type="checkbox"> GUI stability</li>
<li><input disabled="" type="checkbox"> GUI when booting eats up CPU, need GPU accelaration</li>
<li><input disabled="" type="checkbox"> TCP losing packets, “egress” unstable, no congestion control, no real sockets</li>
<li><input disabled="" type="checkbox"> Heap memory allocation bugs</li>
<li><input disabled="" type="checkbox"> Stability in whole, randomly crashes</li>
</ul>


  </article>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <div class="busuanzi center">
    page PV:&nbsp;<span id="busuanzi_value_page_pv"></span>&nbsp;・&nbsp;
    site PV:&nbsp;<span id="busuanzi_value_site_pv"></span>&nbsp;・&nbsp;
    site UV:&nbsp;<span id="busuanzi_value_site_uv"></span>
  </div>


    





    </div>
  </div>
  <footer class="page-footer"><div class="clearfix">
</div>
<div class="right-foot">
    <div class="firstrow">
        <a href="#top" target="_self">
        <svg class="i-caret-right" viewBox="0 0 32 32" width="24" height="24" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3">
            <path d="M10 30 L26 16 10 2 Z"></path>
        </svg>
        </a>
        
    </div>
    <div class="secondrow">
        <a target="_blank" rel="noopener" href="https://github.com/Abracax">
        Abracax
        </a>
    </div>
</div>
<div class="clearfix">
</div>
</footer>
  <script src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script>
<script src="/blog/js/search.min.js"></script>
<script type="text/javascript">

// disqus scripts


// dropdown scripts
$(".dropdown").click(function(event) {
  var current = $(this);
  event.stopPropagation();
  $(current).children(".dropdown-content")[($(current).children(".dropdown-content").hasClass("open"))?'removeClass':'addClass']("open")
});
$(document).click(function(){
    $(".dropdown-content").removeClass("open");
})

var path = "/blog/search.xml";
searchFunc(path, 'local-search-input', 'local-search-result');

</script>

</body>
</html>
