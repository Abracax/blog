<!DOCTYPE html><html lang="en"><head><title>Abracax</title><link rel="alternate" href="/atom.xml" type="application/atom.xml"><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"><link href="https://fonts.googleapis.com/css?family=Playfair+Display" rel="stylesheet"><script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script><meta charset="UTF-8"><link rel="icon" href="/blog/images/favicon.png"><link rel="stylesheet" href="/blog/css/style.css"><link rel="alternate" href="/blog/atom.xml" title="Abracax's Notes" type="application/atom+xml">
</head><body><div class="site-header"><div class="container"><div class="site-branding"><h1 class="site-title">Abracax's Notes<a href="google.com"></a></h1><div class="site-description"><span class="site-description-text"></span></div></div></div></div><div class="menu_box"><div class="menucon"><nav class="navbar navbar-expand-lg navbar-light bg-light"><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><div class="menucon"><ul class="navbar-nav mr-auto"><li class="nav-item active"><a class="nav-link" href="https://anxue.xyz/">About Me</a></li></ul></div><div class="menucon"><ul class="navbar-nav mr-auto"><li class="nav-item active"><a class="nav-link" target="_blank" rel="noopener" href="https://github.com/abracax">GitHub</a></li></ul></div></div></nav></div></div></body><div class="container"><div class="row"><div class="single-post"><article class="post-block"><h1 class="post-title">ARIES</h1><header class="headgallery"></header><div class="row"><div class="tag-box"><div class="tags"></div></div></div><div class="post-content"><h2 id="Stealing-and-Forcing"><a href="#Stealing-and-Forcing" class="headerlink" title="Stealing and Forcing"></a>Stealing and Forcing</h2><p>Stealing happens when buffer pool is full, pages modified by uncommitted transactions can get kicked into stable storage.</p>
<p>Forcing means that every time a transaction commits, all the affected pages will be pushed to stable storage.</p>
<p>STEAL or NO-STEAL – Can an update made by an uncommitted transaction overwrite the most recent committed value of a data item on disk?</p>
<p>FORCE or NO-FORCE – Should all updates of a transaction be forced to disk before the transaction commits?</p>
<ul>
<li>Easiest for recovery: NO-STEAL/FORCE</li>
<li>Highest performance: STEAL/NO-FORCE</li>
<li>Undo logging: Steal/Force<ul>
<li>uncommmited writes?</li>
<li>output early</li>
</ul>
</li>
<li>Redo logging: No-Steal/No-Force<ul>
<li>commited stuff not written</li>
<li>output late</li>
</ul>
</li>
</ul>
<h2 id="Recovery"><a href="#Recovery" class="headerlink" title="Recovery"></a>Recovery</h2><p>The recovery works in three phases.</p>
<ul>
<li>The first phase, <strong>Analysis</strong>, computes all the necessary information from the logfile.  Rebuild active transactions table and dirty pages table.</li>
<li><strong>Redo</strong> some transaction that did commit. Replay history, starting from first recLSN, page granularity. The <strong>Redo</strong> phase restores the database to the exact state at the crash, including all the changes of uncommitted transactions that were running at that point in time.</li>
<li><strong>Undo</strong> other transactions that didn’t commit. The <strong>Undo</strong> phase then undoes all uncommitted changes, leaving the database in a consistent state. Only affects log entries. Write to log as CLR (Compensating log records), redone never undone.</li>
</ul>
<h2 id="WAL"><a href="#WAL" class="headerlink" title="WAL"></a>WAL</h2><p>All log records pertaining to a page are written to disk before the page is overwritten on disk.</p>
<p>All log records for transaction are written to disk before the transaction is considered committed.</p>
<h2 id="Granularity"><a href="#Granularity" class="headerlink" title="Granularity"></a>Granularity</h2><ul>
<li>Page-oriented logging for REDO (element=one page)</li>
<li>Logical logging for UNDO (element=one record)</li>
</ul>
<p>Actual logs logical operations within a page.</p>
<h2 id="Checkpoints"><a href="#Checkpoints" class="headerlink" title="Checkpoints"></a>Checkpoints</h2><p>Write into the log</p>
<p>–  Entire active transactions table</p>
<p> –  Entire dirty page table</p>
<h2 id="ARIES-Data-Structures"><a href="#ARIES-Data-Structures" class="headerlink" title="ARIES Data Structures"></a>ARIES Data Structures</h2><ul>
<li>Active Transactions Table, &lt;trans_id, lastLSN&gt;</li>
<li>Dirty Page Table, &lt;page_id, recLSN&gt;</li>
<li>Write Ahead Log, &lt;LSN, prevLSN, trnas_id, page_id, log_entry&gt;</li>
<li>Buffer pool = table of  pairs  &lt;PageLSN, page_id&gt;</li>
</ul>
<p>LSN= log sequence number, LSN’s help us find the end of a circular log file.</p>
<p>lastLSN = most recent update by transaction</p>
<p>recoveryLSN (recLSN)= first LSN that caused page to become dirty</p>
<p>prevLSN = previous LSN for same transaction</p>
<h2 id="Aries-Steps"><a href="#Aries-Steps" class="headerlink" title="Aries Steps"></a>Aries Steps</h2><ul>
<li>Add log record</li>
<li>Update transactions table</li>
<li>Update dirty page table</li>
<li>Update pageLSN</li>
</ul>
</div></article><div class="paginator"><a class="prev" href="/blog/2021/04/14/WAFL/">prev</a><a class="next" href="/blog/2020/11/15/CUDA/">next</a></div></div></div></div><div class="container-fluid"><div class="row"><div class="footer_box"><a class="col-lg-2 col-xl-2 col-md-2" href="/resume">Contact</a></div></div></div></html>